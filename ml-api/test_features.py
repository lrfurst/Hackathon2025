import joblib
import json
import numpy as np
import os

print("ğŸ” Testando carregamento do modelo...")

# Tentar carregar o modelo
model_path = "model.joblib"
if os.path.exists(model_path):
    print(f"âœ… Encontrado: {model_path}")
    try:
        model = joblib.load(model_path)
        print(f"âœ… Modelo carregado com sucesso!")
        print(f"ğŸ“Š Tipo: {type(model)}")
        
        # Mostrar atributos do modelo
        print(f"\nğŸ”§ Atributos disponÃ­veis:")
        for attr in dir(model):
            if not attr.startswith('_'):
                print(f"  - {attr}")
        
        # Verificar se Ã© pipeline
        if hasattr(model, 'named_steps'):
            print(f"\nğŸ”§ Passos do pipeline:")
            for name, step in model.named_steps.items():
                print(f"  - {name}: {type(step)}")
        
        # Verificar features
        if hasattr(model, 'feature_names_in_'):
            print(f"\nğŸ”¤ Features esperadas (em ordem):")
            for i, name in enumerate(model.feature_names_in_):
                print(f"  {i}: {name}")
        
        # Verificar nÃºmero de features
        if hasattr(model, 'n_features_in_'):
            print(f"\nğŸ“ NÃºmero de features esperadas: {model.n_features_in_}")
        
        # Testar prediÃ§Ã£o simples
        print(f"\nğŸ§ª Testando prediÃ§Ã£o...")
        
        # Criar array de teste com nÃºmero correto de features
        n_features = 6  # Ajuste conforme necessÃ¡rio
        
        # Array de exemplo (6 features como discutido)
        test_array = [[1, 0, 0, 3500.0, 2, 1]]  # Tarde, LATAM, GRU-SCL, 3500km, Quarta, Janeiro
        
        try:
            if hasattr(model, 'predict'):
                prediction = model.predict(test_array)
                print(f"âœ… PrediÃ§Ã£o: {prediction[0]}")
                
                if hasattr(model, 'predict_proba'):
                    proba = model.predict_proba(test_array)
                    print(f"âœ… Probabilidades: {proba[0]}")
                    print(f"   Classe 0 (pontual): {proba[0][0]:.3f}")
                    print(f"   Classe 1 (atrasado): {proba[0][1]:.3f}")
                    
        except Exception as e:
            print(f"âŒ Erro na prediÃ§Ã£o: {e}")
            print("\nğŸ’¡ Tentando com diferentes nÃºmeros de features...")
            
            # Tentar com diferentes tamanhos
            for n in [4, 5, 6, 7, 8]:
                try:
                    test_features = [[1] * n]
                    prediction = model.predict(test_features)
                    print(f"  Com {n} features: {prediction[0]}")
                except:
                    pass
        
    except Exception as e:
        print(f"âŒ Erro ao carregar modelo: {e}")
else:
    print(f"âŒ Arquivo {model_path} nÃ£o encontrado")
    print(f"\nğŸ“ Arquivos na pasta atual:")
    for f in os.listdir('.'):
        print(f"  {f}")